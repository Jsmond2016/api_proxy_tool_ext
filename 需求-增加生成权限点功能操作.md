# 需求-增加生成权限点操作

## 需求背景

参考：

- [背景1](./README_CN.md)
- [背景2](./README_PROXY_TOOL.md)
- [背景3](./需求-基于tag自动同步apifox-mock接口.md)


## 需求目标

- 增加复制、导出权限点功能：即
  - 在分组的表格顶部操作栏，增加-复制权限点 功能，展示下来按钮，可选 复制所有权限点，复制勾选权限点 按钮；
  - 在表格行操作栏，增加-复制权限点 功能，即复制单个权限点功能
- 在页面顶部的操作栏，增加-复制所有权限点 按钮：点击按钮可以复制全局所有分组的权限点，按照指定的格式输出；
- 交互：所有权限点复制按钮点击时，徐弹框弹出，要求填写父级模块名字，填写完成后即可生成对应的 权限点json，写人剪贴板，即可完成复制功能；复制成功给出成功提示；

## 权限点 json 分析

所有复制的权限点 json 按照如下要求：


```json
[
  {
    "parentAuthPointKey": "GEN_PAGE_TODO_请填写父节点-authPointKey",
    "authPointApiUrl": "/demo/user/queryList",
    "authPointKey": "demoUserManagement-queyList",
    "authPointName": "获取用户列表",
    "type": "权限点",
    "priority": null,
    "children": null,
    "desc": "",
    "menuPath": "",
    "prefixPath": "",
    "systemDomain": ""
  }
]

```

字段说明：

- parentAuthPointKey： 即点击复制权限点按钮时弹出的输入框，用户输入的内容，要求格式为字符串
- authPointApiUrl: 即为接口 url，需要判断，若接口实例为 `/api/saas/v1/demo/user/queryList` ，需要从其中的 `v1` 后开始截取；不需要前面的内容；
- authPointName: 接口名字
- authPointKey: 即为上述权限点生成规则的名字
- 其他若干字段，保持同上述字段默认值；




## 技术分析

- 基于从 apifox 获取的 swagger schema 数据，生成对应的 mock 接口的对应权限点；

- 权限点命名规则：分组名 + 接口最后名字
- 示例1：

```
- 分组：demo.user.management
- 接口：/api/demo/user/management/queryList
- 权限点名字：demoUserManagement-queryList
```

- 示例 2：

```
- 分组：demo.user.management
- 接口：/api/demo/user/management/createOneV2
- 权限点名字：demoUserManagement-createOneV2

```

- 技术说明：使用库 change-case 的 camelCase 处理分组名，使用 '-' 连接接口名字


## swagger 文件说明

- 文件说明：参考从 apifox 导出的 swagger json 示例参考文件 `./swagger-version-3-example.json`
- 字段说明：
  - x-apifox-fe-general-model-base-action-type: 该字段为 apifox 自定义字段，用于作为分组名，每个接口都应该有该字段，若没有，则将该接口分配至 默认分组, demo.default；
  - paths: 对象的 key 即为 url，里面的 key 为请求方法；
  - summary: 该字段作为接口中文名字