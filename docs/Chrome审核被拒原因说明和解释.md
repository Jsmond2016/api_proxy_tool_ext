# Chrome å®¡æ ¸è¢«æ‹’åŸå› è¯´æ˜å’Œè§£é‡Š

## ğŸ“‹ é—®é¢˜æ¦‚è¿°

### å®¡æ ¸ç»“æœ

- **è¿è§„è¡Œä¸ºå‚è€ƒ ID**: Purple Potassium
- **è¿è§„è¡Œä¸º**: æ— éœ€ä¸ºäº§å“å®ç°çš„æ–¹æ³•/å±æ€§è¯·æ±‚ä»¥ä¸‹æƒé™ï¼štabs
- **å®¡æ ¸çŠ¶æ€**: è¢«æ‹’ç»

### å®¡æ ¸åé¦ˆåŸæ–‡

> ç§»é™¤ä¸Šè¿°æƒé™ã€‚å³ä½¿ä¸è¯·æ±‚è¿™äº›æƒé™ï¼Œäº§å“ä½¿ç”¨çš„å±æ€§ä¹Ÿä¼šç»§ç»­æ­£å¸¸è¿è¡Œã€‚
>
> è®¡åˆ’æ”¿ç­–çš„ç›¸å…³éƒ¨åˆ†ï¼šä»…è¯·æ±‚ä¸ºå®ç°äº§å“çš„åŠŸèƒ½æˆ–æœåŠ¡è€Œå¿…é¡»å…·å¤‡çš„æœ€åŸºæœ¬æƒé™ã€‚ä¸å¾—ä¸ºäº†ä¿éšœäº§å“çš„æœªæ¥å‘å±•ï¼Œå°è¯•è¯·æ±‚å¯èƒ½ä¼šç»™å°šæœªå®ç°çš„æœåŠ¡æˆ–åŠŸèƒ½å¸¦æ¥å¥½å¤„çš„æƒé™ã€‚

## ğŸ” é—®é¢˜åˆ†æ

### 1. Chrome æ‰©å±•æƒé™æ”¿ç­–

Chrome æ‰©å±•å•†åº—å¯¹æƒé™è¯·æ±‚æœ‰ä¸¥æ ¼çš„æ”¿ç­–è¦æ±‚ï¼š

- **æœ€å°æƒé™åŸåˆ™**: åªè¯·æ±‚å®ç°åŠŸèƒ½æ‰€å¿…éœ€çš„æœ€åŸºæœ¬æƒé™
- **ç¦æ­¢è¿‡åº¦æˆæƒ**: ä¸å¾—ä¸ºäº†æœªæ¥å¯èƒ½çš„åŠŸèƒ½è€Œæå‰è¯·æ±‚æƒé™
- **ç”¨æˆ·éšç§ä¿æŠ¤**: å‡å°‘ä¸å¿…è¦çš„æƒé™è¯·æ±‚ï¼Œæé«˜ç”¨æˆ·ä¿¡ä»»åº¦

### 2. æˆ‘ä»¬çš„é—®é¢˜

åœ¨ `manifest.json` ä¸­å£°æ˜äº† `tabs` æƒé™ï¼š

```json
{
  "permissions": [
    "activeTab",
    "storage",
    "declarativeNetRequest",
    "declarativeNetRequestFeedback",
    "tabs" // âŒ ä¸å¿…è¦çš„æƒé™
  ]
}
```

**é—®é¢˜åŸå› **:

- æ‰©å±•åªéœ€è¦åœ¨ç”¨æˆ·ç‚¹å‡»å›¾æ ‡æ—¶æ‰“å¼€æ–°æ ‡ç­¾é¡µ
- ä¸éœ€è¦è®¿é—®æˆ–æ“ä½œå…¶ä»–æ ‡ç­¾é¡µ
- `tabs` æƒé™è¿‡äºå®½æ³›ï¼Œè¿åäº†æœ€å°æƒé™åŸåˆ™

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ                           | æƒé™éœ€æ±‚    | ç”¨æˆ·ä½“éªŒ | å®¡æ ¸é€šè¿‡ç‡          |
| ------------------------------ | ----------- | -------- | ------------------- |
| ä¿ç•™ `tabs` æƒé™               | `tabs`      | æ–°æ ‡ç­¾é¡µ | âŒ è¢«æ‹’ç»           |
| ä½¿ç”¨ `chrome.windows.create()` | æ— é¢å¤–æƒé™  | å¼¹å‡ºçª—å£ | âœ… é€šè¿‡ä½†ä¸ç¬¦åˆéœ€æ±‚ |
| ä½¿ç”¨ `activeTab` æƒé™          | `activeTab` | æ–°æ ‡ç­¾é¡µ | âœ… æ¨èæ–¹æ¡ˆ         |

### æœ€ç»ˆè§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ `activeTab` æƒé™

#### 1. ä¿®æ”¹ manifest.json

```json
{
  "permissions": [
    "activeTab", // âœ… ä¿ç•™ï¼Œç”¨äºç”¨æˆ·äº¤äº’åè®¿é—®æ ‡ç­¾é¡µ
    "storage", // âœ… ä¿ç•™ï¼Œç”¨äºé…ç½®å­˜å‚¨
    "declarativeNetRequest", // âœ… ä¿ç•™ï¼Œç”¨äºç½‘ç»œè¯·æ±‚æ‹¦æˆª
    "declarativeNetRequestFeedback" // âœ… ä¿ç•™ï¼Œç”¨äºç½‘ç»œè¯·æ±‚åé¦ˆ
  ]
}
```

#### 2. ä¿®æ”¹ background script

```typescript
// ä¿®æ”¹å‰ - éœ€è¦ tabs æƒé™
chrome.action.onClicked.addListener((tab) => {
  chrome.tabs.create({
    url: chrome.runtime.getURL("src/pages/options/index.html"),
  });
});

// ä¿®æ”¹å - ä½¿ç”¨ activeTab æƒé™
chrome.action.onClicked.addListener((tab) => {
  // activeTab æƒé™å…è®¸åœ¨ç”¨æˆ·äº¤äº’åä½¿ç”¨ chrome.tabs.create()
  chrome.tabs.create({
    url: chrome.runtime.getURL("src/pages/options/index.html"),
  });
});
```

## ğŸ“š Chrome æ‰©å±•æƒé™æœºåˆ¶è¯¦è§£

### 1. æƒé™ç±»å‹å¯¹æ¯”

| æƒé™ç±»å‹    | å£°æ˜æ–¹å¼                       | ä½¿ç”¨èŒƒå›´               | API è®¿é—®                 | å®‰å…¨çº§åˆ«    |
| ----------- | ------------------------------ | ---------------------- | ------------------------ | ----------- |
| `tabs`      | `"permissions": ["tabs"]`      | å…¨å±€è®¿é—®æ‰€æœ‰æ ‡ç­¾é¡µ     | å®Œæ•´çš„ `chrome.tabs` API | ğŸ”´ é«˜é£é™©   |
| `activeTab` | `"permissions": ["activeTab"]` | ä»…åœ¨ç”¨æˆ·äº¤äº’åä¸´æ—¶è®¿é—® | æœ‰é™çš„ `chrome.tabs` API | ğŸŸ¡ ä¸­ç­‰é£é™© |

### 2. `activeTab` æƒé™å·¥ä½œåŸç†

**è§¦å‘æ¡ä»¶**:

- ç”¨æˆ·ç‚¹å‡»æ‰©å±•å›¾æ ‡
- ç”¨æˆ·ä½¿ç”¨å³é”®èœå•
- ç”¨æˆ·ä½¿ç”¨å¿«æ·é”®
- å…¶ä»–ç”¨æˆ·ä¸»åŠ¨äº¤äº’

**å…è®¸çš„æ“ä½œ**:

```typescript
// âœ… åœ¨ç”¨æˆ·äº¤äº’ä¸Šä¸‹æ–‡ä¸­å¯ä»¥ä½¿ç”¨
chrome.tabs.create(); // åˆ›å»ºæ–°æ ‡ç­¾é¡µ
chrome.tabs.update(); // æ›´æ–°å½“å‰æ ‡ç­¾é¡µ
chrome.tabs.query(); // æŸ¥è¯¢å½“å‰æ ‡ç­¾é¡µä¿¡æ¯
```

**ä¸å…è®¸çš„æ“ä½œ**:

```typescript
// âŒ éœ€è¦ tabs æƒé™
chrome.tabs.query({}, callback); // è®¿é—®æ‰€æœ‰æ ‡ç­¾é¡µ
chrome.tabs.remove(tabId); // å…³é—­å…¶ä»–æ ‡ç­¾é¡µ
```

### 3. æƒé™å®‰å…¨æœºåˆ¶

**Chrome çš„è®¾è®¡ç†å¿µ**:

- **æœ€å°æƒé™åŸåˆ™**: åªæˆäºˆå¿…è¦çš„æƒé™
- **ç”¨æˆ·æ§åˆ¶**: ç”¨æˆ·æ˜ç¡®çŸ¥é“ä½•æ—¶æ‰©å±•ä¼šè®¿é—®æ ‡ç­¾é¡µ
- **ä¸´æ—¶è®¿é—®**: `activeTab` æƒé™åªåœ¨äº¤äº’æ—¶ç”Ÿæ•ˆ
- **éšç§ä¿æŠ¤**: å‡å°‘ä¸å¿…è¦çš„å…¨å±€è®¿é—®

## ğŸ¯ æœ€ä½³å®è·µ

### 1. æƒé™ç”³è¯·åŸåˆ™

```json
{
  "permissions": [
    // âœ… åªç”³è¯·å¿…è¦çš„æƒé™
    "activeTab", // ç”¨æˆ·äº¤äº’åè®¿é—®æ ‡ç­¾é¡µ
    "storage", // é…ç½®æ•°æ®å­˜å‚¨
    "declarativeNetRequest" // ç½‘ç»œè¯·æ±‚æ‹¦æˆª
  ],
  "host_permissions": [
    // âœ… æ˜ç¡®æŒ‡å®šéœ€è¦è®¿é—®çš„ç½‘ç«™
    "http://*/*",
    "https://*/*"
  ]
}
```

### 2. ä»£ç å®ç°å»ºè®®

```typescript
// âœ… æ¨èï¼šåœ¨ç”¨æˆ·äº¤äº’åæ“ä½œ
chrome.action.onClicked.addListener((tab) => {
  chrome.tabs.create({ url: "options.html" });
});

// âŒ é¿å…ï¼šç¨‹åºåŒ–è®¿é—®
setTimeout(() => {
  chrome.tabs.create({ url: "popup.html" });
}, 5000);
```

### 3. å®¡æ ¸å‡†å¤‡

**æäº¤å‰æ£€æŸ¥æ¸…å•**:

- [ ] ç§»é™¤æ‰€æœ‰ä¸å¿…è¦çš„æƒé™
- [ ] ç¡®ä¿æ¯ä¸ªæƒé™éƒ½æœ‰æ˜ç¡®çš„åŠŸèƒ½éœ€æ±‚
- [ ] æµ‹è¯•æƒé™ç§»é™¤ååŠŸèƒ½æ˜¯å¦æ­£å¸¸
- [ ] å‡†å¤‡æƒé™ä½¿ç”¨è¯´æ˜æ–‡æ¡£

## ğŸ“ˆ ä¿®æ”¹æ•ˆæœ

### ä¿®æ”¹å‰

- âŒ è¯·æ±‚ `tabs` æƒé™ï¼ˆè¿‡äºå®½æ³›ï¼‰
- âŒ å®¡æ ¸è¢«æ‹’ç»
- âŒ ç”¨æˆ·å¯èƒ½æ‹…å¿ƒéšç§é—®é¢˜

### ä¿®æ”¹å

- âœ… åªä½¿ç”¨ `activeTab` æƒé™ï¼ˆç²¾ç¡®æ§åˆ¶ï¼‰
- âœ… ç¬¦åˆ Chrome æƒé™æ”¿ç­–
- âœ… æé«˜ç”¨æˆ·ä¿¡ä»»åº¦
- âœ… ä¿æŒåŸæœ‰åŠŸèƒ½ä¸å˜

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. æƒé™æ£€æŸ¥

```typescript
// æ£€æŸ¥æƒé™æ˜¯å¦å¯ç”¨
chrome.permissions.contains(
  {
    permissions: ["activeTab"],
  },
  (result) => {
    if (result) {
      console.log("activeTab æƒé™å¯ç”¨");
    }
  },
);
```

### 2. é”™è¯¯å¤„ç†

```typescript
chrome.action.onClicked.addListener(async (tab) => {
  try {
    await chrome.tabs.create({
      url: chrome.runtime.getURL("src/pages/options/index.html"),
    });
  } catch (error) {
    console.error("æ— æ³•åˆ›å»ºæ–°æ ‡ç­¾é¡µ:", error);
    // é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨ options_ui
    chrome.runtime.openOptionsPage();
  }
});
```

### 3. å…¼å®¹æ€§è€ƒè™‘

```typescript
// æ£€æŸ¥ API å¯ç”¨æ€§
if (chrome.tabs && chrome.tabs.create) {
  chrome.tabs.create({ url: "options.html" });
} else {
  // é™çº§æ–¹æ¡ˆ
  window.open("options.html", "_blank");
}
```

## ğŸ“ æ€»ç»“

é€šè¿‡ä½¿ç”¨ `activeTab` æƒé™æ›¿ä»£ `tabs` æƒé™ï¼Œæˆ‘ä»¬æˆåŠŸè§£å†³äº† Chrome æ‰©å±•å®¡æ ¸è¢«æ‹’çš„é—®é¢˜ï¼š

1. **ç¬¦åˆæ”¿ç­–è¦æ±‚**: éµå¾ªæœ€å°æƒé™åŸåˆ™
2. **ä¿æŒåŠŸèƒ½å®Œæ•´**: ç”¨æˆ·ä»å¯åœ¨æ–°æ ‡ç­¾é¡µä¸­æ“ä½œ
3. **æé«˜å®‰å…¨æ€§**: å‡å°‘ä¸å¿…è¦çš„æƒé™è¯·æ±‚
4. **å¢å¼ºç”¨æˆ·ä½“éªŒ**: ç”¨æˆ·æ›´ä¿¡ä»»æ‰©å±•çš„å®‰å…¨æ€§

è¿™ä¸ªè§£å†³æ–¹æ¡ˆæ—¢æ»¡è¶³äº†åŠŸèƒ½éœ€æ±‚ï¼Œåˆç¬¦åˆ Chrome æ‰©å±•å•†åº—çš„å®¡æ ¸æ ‡å‡†ï¼Œæ˜¯ä¸€ä¸ªç†æƒ³çš„å¹³è¡¡æ–¹æ¡ˆã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025å¹´12æœˆ
**é€‚ç”¨ç‰ˆæœ¬**: Chrome Extension Manifest V3
**ç›¸å…³æ–‡ä»¶**: `manifest.json`, `src/pages/background/index.ts`
